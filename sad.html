<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

    <title>Dot density | Sample | ArcGIS API for JavaScript 4.24</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="src/input.css">
    <link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/dark/main.css" />
    <script src="https://js.arcgis.com/4.24/"></script>

    <!-- INITIAL MAP -->
    <script>
      require([
        "esri/WebMap",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/renderers/DotDensityRenderer",
        "esri/widgets/Legend",
        "esri/widgets/Bookmarks",
        "esri/widgets/Expand"
      ], (WebMap, MapView, FeatureLayer, DotDensityRenderer, Legend, Bookmarks, Expand) => {
        const map = new WebMap({
          portalItem: {
            id: "56b5bd522c52409c90d902285732e9f1"
          }
        });

        const view = new MapView({
          container: "viewDiv",
          map: map,
          highlightOptions: {
            fillOpacity: 0,
            color: [50, 50, 50]
          },
          popup: {
            dockEnabled: true,
            dockOptions: {
              position: "top-right",
              breakpoint: false
            }
          },
          constraints: {
            maxScale: 35000
          }
        });

        view.when().then(() => {
          const dotDensityRenderer = new DotDensityRenderer({
            dotValue: 100,
            outline: null,
            referenceScale: 577790,  // 1:577,790 view scale
            legendOptions: {
              unit: "people"
            },
            attributes: [
              {
                field: "B03002_003E",
                color: "#f23c3f",
                label: "White (non-Hispanic)"
              },
              {
                field: "B03002_012E",
                color: "#e8ca0d",
                label: "Hispanic"
              },
              {
                field: "B03002_004E",
                color: "#00b6f1",
                label: "Black or African American"
              },
              {
                field: "B03002_006E",
                color: "#32ef94",
                label: "Asian"
              },
              {
                field: "B03002_005E",
                color: "#ff7fe9",
                label: "American Indian/Alaskan Native"
              },
              {
                field: "B03002_007E",
                color: "#e2c4a5",
                label: "Pacific Islander/Hawaiian Native"
              },
              {
                field: "B03002_008E",
                color: "#ff6a00",
                label: "Other race"
              },
              {
                field: "B03002_009E",
                color: "#96f7ef",
                label: "Two or more races"
              }
            ]
          });

          // Add renderer to the layer and define a popup template
          const url =
            "https://services.arcgis.com/P3ePLMYs2RVChkJx/arcgis/rest/services/ACS_Population_by_Race_and_Hispanic_Origin_Boundaries/FeatureServer/2";
          const layer = new FeatureLayer({
            url: url,
            minScale: 20000000,
            maxScale: 35000,
            title: "Current Population Estimates (ACS)",
            popupTemplate: {
              title: "{County}, {State}",
              content: [
              {
                  type: "media",
                  mediaInfos: [
                    {
                      title: "Current Population Estimates (ACS)",
                      type: "bar-chart",
                      value: {
                        fields: [
                          "B03002_003E",
                          "B03002_012E",
                          "B03002_004E",
                          "B03002_006E",
                          "B03002_005E",
                          "B03002_007E",
                          "B03002_008E",
                          "B03002_008E",
                          "B03002_009E"
                        ],
                        tooltipField: "<field name>"
                      }
                    }
                  ]
                },
                {
                  type: "fields",
                }
              ],
              fieldInfos: [
                {
                  fieldName: "B03002_003E",
                  label: "White (non-Hispanic)",
                  format: {
                    digitSeparator: true,
                    places: 0,
                  },
                },
                {
                  fieldName: "B03002_012E",
                  label: "Hispanic",
                  format: {
                    digitSeparator: true,
                    places: 0,
                  },
                },
                {
                  fieldName: "B03002_004E",
                  label: "Black or African American",
                  format: {
                    digitSeparator: true,
                    places: 0,
                  },
                },
                {
                  fieldName: "B03002_006E",
                  label: "Asian",
                  format: {
                    digitSeparator: true,
                    places: 0,
                  },
                },
                {
                  fieldName: "B03002_005E",
                  label: "American Indian/Alaskan Native",
                  format: {
                    digitSeparator: true,
                    places: 0,
                  },
                },
                {
                  fieldName: "B03002_007E",
                  label: "Pacific Islander/Hawaiian Native",
                  format: {
                    digitSeparator: true,
                    places: 0,
                  },
                },
                {
                  fieldName: "B03002_008E",
                  label: "Other race",
                  format: {
                    digitSeparator: true,
                    places: 0,
                  },
                },
                {
                  fieldName: "B03002_009E",
                  label: "Two or more races",
                  format: {
                    digitSeparator: true,
                    places: 0,
                  }
                }
              ]
            },
            renderer: dotDensityRenderer
          });

          map.add(layer);

          view.ui.add(
            [
              new Expand({
                view: view,
                content: new Legend({ view: view }),
                group: "top-left",
                expanded: true
              }),
              new Expand({
                view: view,
                content: new Bookmarks({ view: view }),
                group: "top-left"
              })
            ],
            "top-left"
          );
        });
      });
    </script>

    <!-- OTHER MAP -->
    <script>
      require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/widgets/Legend",
        "esri/widgets/Slider",
        "esri/widgets/Expand"
      ], (Map, MapView, FeatureLayer, Legend, Slider, Expand
      ) => {
        // Configure clustering on the layer with a
        // popupTemplate displaying the predominant
        // fuel type of the power plants in the cluster
    
        const clusterLabelThreshold = 1500;
    
        const haloColor = "#373837";
        const color = "#f0f0f0";
    
        const clusterConfig = {
          type: "cluster",
          popupTemplate: {
            title: "Cluster summary",
            content: [
              {
                type: "text",
                text: `
                This cluster represents <b>{cluster_count}</b> power plants with an average capacity of <b>{cluster_avg_capacity_mw} megawatts</b>.
                 The power plants in this cluster produce a total of <b>{expression/total-mw} megawatts</b> of power.`
              },
              {
                type: "text",
                text: "Most power plants in this cluster generate power from <b>{cluster_type_fuel1}</b>."
              }
            ],
            fieldInfos: [{
              fieldName: "cluster_count",
              format: {
                places: 0,
                digitSeparator: true
              }
            }, {
              fieldName: "cluster_avg_capacity_mw",
              format: {
                places: 2,
                digitSeparator: true
              }
            }, {
              fieldName: "expression/total-mw",
              format: {
                places: 0,
                digitSeparator: true
              }
            }],
            expressionInfos: [{
              name: "total-mw",
              title: "total megawatts",
              expression: "$feature.cluster_avg_capacity_mw * $feature.cluster_count"
            }]
          },
          // larger radii look better with multiple label classes
          // smaller radii looks better visually
          clusterRadius: "120px",
          labelsVisible: true,
          labelingInfo: [{
            symbol: {
              type: "text",
              haloColor,
              haloSize: "1px",
              color,
              font: {
                family: "Noto Sans",
                size: "11px"
              },
              xoffset: 0,
              yoffset: "-15px",
            },
            labelPlacement: "center-center",
            labelExpressionInfo: {
              expression: "Text($feature.cluster_count, '#,### plants')"
            },
            where: `cluster_avg_capacity_mw > ${clusterLabelThreshold}`
          }, {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "2px",
              color,
              font: {
                weight: "bold",
                family: "Noto Sans",
                size: "18px"
              },
              xoffset: 0,
              yoffset: 0
            },
            labelPlacement: "center-center",
            labelExpressionInfo: {
              expression: "$feature.cluster_type_fuel1"
            },
            where: `cluster_avg_capacity_mw > ${clusterLabelThreshold}`
          }, {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "1px",
              color,
              font: {
                weight: "bold",
                family: "Noto Sans",
                size: "12px"
              },
              xoffset: 0,
              yoffset: "15px"
            },
            deconflictionStrategy: "none",
            labelPlacement: "center-center",
            labelExpressionInfo: {
              expression: `
              var value = $feature.cluster_avg_capacity_mw;
              var num = Count(Text(Round(value)));
    
              Decode(num,
                4, Text(value / Pow(10, 3), "##.0k"),
                5, Text(value / Pow(10, 3), "##k"),
                6, Text(value / Pow(10, 3), "##k"),
                7, Text(value / Pow(10, 6), "##.0m"),
                Text(value, "#,###")
              );
              `
            },
            where: `cluster_avg_capacity_mw > ${clusterLabelThreshold}`
          }, {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "1px",
              color,
              font: {
                family: "Noto Sans",
                size: "11px"
              },
              xoffset: 0,
              yoffset: "-15px",
            },
            labelPlacement: "above-right",
            labelExpressionInfo: {
              expression: "Text($feature.cluster_count, '#,### plants')"
            },
            where: `cluster_avg_capacity_mw <= ${clusterLabelThreshold}`
          }, {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "2px",
              color,
              font: {
                weight: "bold",
                family: "Noto Sans",
                size: "18px"
              }
            },
            labelPlacement: "above-right",
            labelExpressionInfo: {
              expression: "$feature.cluster_type_fuel1"
            },
            where: `cluster_avg_capacity_mw <= ${clusterLabelThreshold}`
          },  {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "1px",
              color,
              font: {
                weight: "bold",
                family: "Noto Sans",
                size: "12px"
              },
              xoffset: 0,
              yoffset: 0
            },
            labelPlacement: "center-center",
            labelExpressionInfo: {
              expression: `
              var value = $feature.cluster_avg_capacity_mw;
              var num = Count(Text(Round(value)));
    
              Decode(num,
                4, Text(value / Pow(10, 3), "##.0k"),
                5, Text(value / Pow(10, 3), "##k"),
                6, Text(value / Pow(10, 3), "##k"),
                7, Text(value / Pow(10, 6), "##.0m"),
                Text(value, "#,###")
              );
              `
            },
            where: `cluster_avg_capacity_mw <= ${clusterLabelThreshold}`
          }]
        };
    
        const layer = new FeatureLayer({
          portalItem: {
            id: "eb54b44c65b846cca12914b87b315169"
          },
          featureReduction: clusterConfig,
          popupEnabled: true,
          labelsVisible: true,
          labelingInfo: [{
            symbol: {
              type: "text",
              haloColor,
              haloSize: "1px",
              color,
              font: {
                family: "Noto Sans",
                size: "11px"
              },
              xoffset: 0,
              yoffset: "-15px",
            },
            labelPlacement: "center-center",
            labelExpressionInfo: {
              expression: "$feature.name"
            },
            where: `capacity_mw > ${clusterLabelThreshold}`
          }, {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "2px",
              color,
              font: {
                weight: "bold",
                family: "Noto Sans",
                size: "18px"
              },
              xoffset: 0,
              yoffset: 0
            },
            labelPlacement: "center-center",
            labelExpressionInfo: {
              expression: "$feature.fuel1"
            },
            where: `capacity_mw > ${clusterLabelThreshold}`
          }, {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "1px",
              color,
              font: {
                weight: "bold",
                family: "Noto Sans",
                size: "12px"
              },
              xoffset: 0,
              yoffset: "15px"
            },
            labelPlacement: "center-center",
            labelExpressionInfo: {
              expression: `
              var value = $feature.capacity_mw;
              var num = Count(Text(Round(value)));
    
              Decode(num,
                4, Text(value / Pow(10, 3), "##.0k"),
                5, Text(value / Pow(10, 3), "##k"),
                6, Text(value / Pow(10, 3), "##k"),
                7, Text(value / Pow(10, 6), "##.0m"),
                Text(value, "#,###")
              );
              `
            },
            where: `capacity_mw > ${clusterLabelThreshold}`
          }, {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "1px",
              color,
              font: {
                family: "Noto Sans",
                size: "11px"
              },
              xoffset: 0,
              yoffset: "-15px",
            },
            labelPlacement: "above-right",
            labelExpressionInfo: {
              expression: "$feature.name"
            },
            where: `capacity_mw <= ${clusterLabelThreshold}`
          }, {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "2px",
              color,
              font: {
                weight: "bold",
                family: "Noto Sans",
                size: "18px"
              }
            },
            labelPlacement: "above-right",
            labelExpressionInfo: {
              expression: "$feature.fuel1"
            },
            where: `capacity_mw <= ${clusterLabelThreshold}`
          }, {
            symbol: {
              type: "text",
              haloColor,
              haloSize: "1px",
              color,
              font: {
                weight: "bold",
                family: "Noto Sans",
                size: "12px"
              },
              xoffset: 0,
              yoffset: 0
            },
            labelPlacement: "center-center",
            labelExpressionInfo: {
              expression: `
              var value = $feature.capacity_mw;
              var num = Count(Text(Round(value)));
    
              Decode(num,
                4, Text(value / Pow(10, 3), "##.0k"),
                5, Text(value / Pow(10, 3), "##k"),
                6, Text(value / Pow(10, 3), "##k"),
                7, Text(value / Pow(10, 6), "##.0m"),
                Text(value, "#,###")
              );
              `
            },
            where: `capacity_mw <= ${clusterLabelThreshold}`
          }]
        });
    
        const map = new Map({
          basemap: {
            portalItem: {
              id: "8d91bd39e873417ea21673e0fee87604"
            }
          },
          layers: [layer]
        });
    
        const view = new MapView({
          container: "otherDiv",
          map: map,
          extent: {
            spatialReference: {
              latestWkid: 3857,
              wkid: 102100
            },
            xmin: -42087672,
            ymin: 4108613,
            xmax: -36095009,
            ymax: 8340167
          }
        });
    
        layer.when().then(() =>{
          const renderer = layer.renderer.clone();
          renderer.visualVariables = [{
            type: "size",
            field: "capacity_mw",
            legendOptions: {
              title: "Capacity (MW)"
            },
            minSize: "24px",
            maxSize: "100px",
            minDataValue: 1,
            maxDataValue: 5000
          }];
          layer.renderer = renderer;
        });
    
        const legend = new Legend({
          view: view,
          container: "legendDiv"
        });
    
        const infoDiv = document.getElementById("infoDiv");
        view.ui.add(
          new Expand({
            view: view,
            content: infoDiv,
            expandIconClass: "esri-icon-layer-list",
            expanded: true
          }),
          "top-right"
        );
    
        view.whenLayerView(layer).then((layerView) => {
          const field = "capacity_mw";
    
          const slider = new Slider({
            min: 0,
            max: 2000,
            values: [0],
            container: document.getElementById("sliderDiv"),
            visibleElements: {
              rangeLabels: true
            },
            precision: 0
          });
    
          const sliderValue = document.getElementById("sliderValue");
    
          // filter features by power plant capacity when the user
          // drags the slider thumb. If clustering is enabled,
          // clusters will recompute and render based on the number
          // and type of features that satisfy the filter where clause
    
          slider.on(["thumb-change", "thumb-drag"], (event) => {
            sliderValue.innerText = event.value;
            layerView.filter = {
              where: field + " >= " + event.value
            };
          });
        });
      });
    </script>
  </head>

  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-dark bg-primary">
      <span class="navbar-brand mb-0 h1" style="padding-left: 20px;">GEOSPATIAL WITH CUSTOMISABLE GLYPHS</span>
    </nav>

    <!-- MAP -->
      <div id="viewDiv" style="padding: 10px;">
        </div>
    <!-- OTHER MAP -->
    <div id="otherDiv"></div>
    <div id="infoDiv" class="esri-widget">
      <div id="description">
        Show power plants with at least <span id="sliderValue">0</span> megawatts of capacity
      </div>
      <div id="sliderContainer">
        <div id="sliderDiv"></div>
      </div>
      <div id="legendDiv"></div>
    </div>
    <!-- BUTTONS     -->
      <div class="container">
        <div class="row" style="margin-left: 10rem;">
          <div class="col-lg-3">
            <button type="button" class="btn btn-outline-primary" id="prevDay">⏪⏪Previous Day</button>
          </div>

          <div class="col-lg-3">
            <button type="button" class="btn btn-outline-primary">⏪Previous Day</button>
          </div>

          <div class="col-lg-3">
            <button type="button" class="btn btn-outline-primary">Next Day⏩</button>
          </div>

          <div class="col-lg-3">
            <button type="button" class="btn btn-outline-primary">Next Day⏩⏩</button>
          </div>
        </div>
      </div>

      <!-- CARDS -->
      <div class="container" style="padding-left: 17rem; padding-top: 10px;">
        <div class="row">
            <div class="card border-primary mb-3 col-lg-4" style="width: 17rem; margin-top: 3%; margin-left: 0.5%; border-radius: 15px; background-color: white; justify-content: center; align-items: center; padding-left: 30px; padding-right: 15px; padding-top: 10px; padding-bottom: 10px;">
                <div class="card-body">
                  <style>
                  </style>
                  <h5 class="card-title">Max. Temperature</h5>
                  <h3 class="card-title" style="color: #0275d8; text-align: center;"><strong>93F</strong></h3>
                  </div>
              </div>

              <div class="card border-primary mb-3 col-lg-4" style="width: 17rem; margin-top: 3%; margin-left: 0.5%; border-radius: 15px; background-color: white; justify-content: center; align-items: center; padding-left: 30px; padding-right: 15px; padding-top: 10px; padding-bottom: 10px;">
                <div class="card-body">
                  <h5 class="card-title">Min. Temperature</h5>
                  <h3 class="card-title" style="color: #0275d8; text-align: center;"><strong>28F</strong></h3>
                  </div>
               </div>

               <div class="card border-primary mb-3 col-lg-4" style="width: 17rem; margin-top: 3%; margin-left: 0.5%; border-radius: 15px; background-color: white; justify-content: center; align-items: center; padding-left: 30px; padding-right: 15px; padding-top: 10px; padding-bottom: 10px;">
                <div class="card-body">
                  <h5 class="card-title">Max. Rainfall</h5>
                  <h3 class="card-title" style="color: #0275d8; text-align: center;"><strong>30CM</strong></h3>
                  </div>
               </div>
        </div>
    </div>
  <script src="index.js" charset="utf-8"></script>
  </body>
</html>